<div
    *ngIf="allStrains.length === 0"
    class="flex-center h100"
    style="flex-direction: column"
>
    <strong>
        CCASM is either loading the collection or was unable to get the
        results...
    </strong>
    <br />
    <span> Please refresh if issue persists. </span>
</div>

<div class="h100" style="padding: 32px" *ngIf="allStrains.length > 0">
    <div class="flex-box">
        <button mat-raised-button (click)="exportAll()">
            Download Entire Collection
        </button>

        <span class="flex"></span>

        <mat-radio-group [(ngModel)]="searchType" style="padding-right: 32px">
            <mat-radio-button [value]="'simple'"> Simple </mat-radio-button>
            <mat-radio-button [value]="'complex'"> Complex </mat-radio-button>
        </mat-radio-group>
    </div>

    <ng-container *ngIf="searchType == 'simple'">
        <app-simple-search
            [options]="simpleOptions"
            (searchString)="simpleSearch($event)"
        ></app-simple-search>
    </ng-container>

    <ng-container *ngIf="searchType == 'complex'">
        <app-complex-search
            [options]="complexOptions"
            (searchStrings)="complexSearch($event)"
        ></app-complex-search>
    </ng-container>

    <mat-divider style="margin: 22px"></mat-divider>

    <ng-container *ngIf="filteredStrains === null">
        <mat-tree
            class="strain-tree"
            [dataSource]="treeDataSource"
            [treeControl]="treeControl"
        >
            <mat-tree-node
                *matTreeNodeDef="let node"
                (click)="simpleSearch(node.name)"
                matTreeNodeToggle
            >
                {{ node.name }}
            </mat-tree-node>

            <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
                <div class="mat-tree-node">
                    <button
                        mat-icon-button
                        matTreeNodeToggle
                        [attr.aria-label]="'Toggle ' + node.name"
                    >
                        <mat-icon class="mat-icon-rtl-mirror">
                            {{
                                treeControl.isExpanded(node)
                                    ? "expand_more"
                                    : "chevron_right"
                            }}
                        </mat-icon>
                    </button>
                    {{ node.name }} ({{ recursiveCount(node) }})
                </div>

                <div
                    [class.strain-tree-invisible]="
                        !treeControl.isExpanded(node)
                    "
                    role="group"
                >
                    <ng-container matTreeNodeOutlet></ng-container>
                </div>
            </mat-nested-tree-node>
        </mat-tree>
    </ng-container>

    <ng-container *ngIf="filteredStrains !== null">
        <ng-container *ngIf="filteredStrains.length > 0">
            <button mat-raised-button (click)="exportFiltered()">
                Download Filtered Collection
            </button>

            <button mat-raised-button (click)="clearResults()">
                <mat-icon>undo</mat-icon>
                Clear Results
            </button>

            <ng-container *ngFor="let s of filteredStrains">
                <mat-card
                    (click)="openStrainInformation(s)"
                    style="background-color: #ececec"
                >
                    <mat-card-title>
                        <strong>CCASM ID:</strong> {{ s.ccasmId }}
                        <strong>Binomial Classification:</strong>
                        {{ s.binomialClassification }}
                    </mat-card-title>
                    <mat-card-content>
                        <strong>Taxonomic Lineage:</strong>
                        {{ s.taxonomicLineage }}
                    </mat-card-content>
                </mat-card>
            </ng-container>
        </ng-container>

        <ng-container *ngIf="filteredStrains.length === 0">
            <br />
            There are no strains that match the desired attributes.
        </ng-container>
    </ng-container>
</div>
