<div class="w100 h100" style="padding: 32px">
  <div style="display: flex">
    <span class="flex"></span>
    <mat-radio-group [(ngModel)]="searchType">
      <mat-radio-button [value]="'simple'"> Simple </mat-radio-button>
      <mat-radio-button [value]="'complex'"> Complex </mat-radio-button>
    </mat-radio-group>
    <span style="width: 32px"></span>
    <button mat-raised-button (click)="exportAll()">
      Download Entire Collection
    </button>
  </div>

  <ng-container *ngIf="searchType == 'simple'">
    <app-simple-search
      [options]="simpleOptions"
      (searchString)="simpleSearch($event)"
    ></app-simple-search>
  </ng-container>

  <ng-container *ngIf="searchType == 'complex'">
    <app-complex-search
      [options]="complexOptions"
      (searchStrings)="complexSearch($event)"
    ></app-complex-search>
  </ng-container>

  <!-- TODO: change the height -->
  <ng-container *ngIf="filteredStrains === null">
    <mat-tree
      [dataSource]="treeDataSource"
      [treeControl]="treeControl"
      class="strain-tree"
    >
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
        {{ node.name }}
      </mat-tree-node>

      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <div class="mat-tree-node">
          <button
            mat-icon-button
            matTreeNodeToggle
            [attr.aria-label]="'Toggle ' + node.name"
          >
            <mat-icon class="mat-icon-rtl-mirror">
              {{
                treeControl.isExpanded(node) ? "expand_more" : "chevron_right"
              }}
            </mat-icon>
          </button>
          {{ node.name }} ({{ recursiveCount(node) }})
        </div>

        <div
          [class.strain-tree-invisible]="!treeControl.isExpanded(node)"
          role="group"
        >
          <ng-container matTreeNodeOutlet></ng-container>
        </div>
      </mat-nested-tree-node>
    </mat-tree>
  </ng-container>

  <ng-container *ngIf="filteredStrains !== null">
    <ng-container *ngIf="filteredStrains.length > 0">
      <button mat-raised-button (click)="clearResults()">
        <mat-icon>undo</mat-icon>
        Clear Results
      </button>

      <button mat-raised-button (click)="exportFiltered()">
        Download Filtered Collection
      </button>

      <ng-container *ngFor="let s of filteredStrains">
        <mat-card (click)="openStrainInformation(s)">
          <mat-card-title>
            <strong>Strain Name:</strong> {{ s.strainName }}
            <strong>Binomial Classification:</strong>
            {{ s.binomialClassification }}
          </mat-card-title>
          <mat-card-content>
            <strong>Taxonomic Lineage:</strong>
            {{ s.taxonomicLineage }}
          </mat-card-content>
        </mat-card>
      </ng-container>
    </ng-container>

    <ng-container *ngIf="filteredStrains.length === 0">
      <br />
      There are no strains that match the desired attributes.
    </ng-container>
  </ng-container>
</div>
